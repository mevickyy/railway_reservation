<!DOCTYPE html>
<html lang="en">
   <head>
      <title>Train Ticket management System </title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="description" content="#">
      <meta name="keywords" content="Train Ticket management System">
      <meta name="author" content="#">
      <!-- Google font-->
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,800" rel="stylesheet">
      <!-- Required Fremwork -->
      <link rel="stylesheet" type="text/css" href="assets/bower_components/bootstrap/css/bootstrap.min.css">
      <!-- themify-icons line icon -->
      <link rel="stylesheet" type="text/css" href="assets/icon/themify-icons/themify-icons.css">
      <link rel="stylesheet" type="text/css" href="assets/icon/icofont/css/icofont.css">
      <!-- Style.css -->
      <link rel="stylesheet" type="text/css" href="assets/css/style.css">
      <link rel="stylesheet" type="text/css" href="assets/css/jquery.mCustomScrollbar.css">
      <link rel="stylesheet" type="text/css" href="assets/css/pcoded-horizontal.min.css">
   </head>
   <!-- Menu horizontal fixed layout -->
   <body>
      <!-- Pre-loader start -->
      <div class="theme-loader">
         <div class="ball-scale">
            <div class='contain'>
               <div class="loader-default">
                  <div class="frame"></div>
               </div>
               <div class="loader-default">
                  <div class="frame"></div>
               </div>
               <div class="loader-default">
                  <div class="frame"></div>
               </div>
               <div class="loader-default">
                  <div class="frame"></div>
               </div>
               <div class="loader-default">
                  <div class="frame"></div>
               </div>
               <div class="loader-default">
                  <div class="frame"></div>
               </div>
               <div class="loader-default">
                  <div class="frame"></div>
               </div>
               <div class="loader-default">
                  <div class="frame"></div>
               </div>
               <div class="loader-default">
                  <div class="frame"></div>
               </div>
               <div class="loader-default">
                  <div class="frame"></div>
               </div>
            </div>
         </div>
      </div>
      <!-- Pre-loader end -->
      <div id="pcoded" class="pcoded">
         <div class="pcoded-container">
            <!-- Menu header start -->
            <nav class="navbar header-navbar pcoded-header">
               <div class="navbar-wrapper">
                  <div class="navbar-logo">
                     <a class="mobile-menu" id="mobile-collapse" href="#!">
                     <i class="ti-menu"></i>
                     </a>
                     <a class="mobile-search morphsearch-search" href="#">
                     <i class="ti-search"></i>
                     </a>
                     <a href="index.html">
                     <img class="img-fluid" src="assets/images/logo.png" height="60" width="100" alt="Theme-Logo" />
                     </a>
                     <a class="mobile-options">
                     <i class="ti-more"></i>
                     </a>
                  </div>
                  <div style="float: left; font-size: 30px">RAILWAY</div>
                    <img  id="midpic" src="assets/images/thumbnail.gif" style="margin-left: 148px; float: left">
                    <div style="float: right; font-size: 30px; margin-right:200px;">RESERVATION</div>
               </div>
            </nav>
            <!-- Menu header end -->
            <div class="pcoded-main-container">
               <nav class="pcoded-navbar">
                  <div class="pcoded-inner-navbar">
                     <ul class="pcoded-item pcoded-left-item">
                        <li class="pcoded-hasmenu">
                           <a href="index.html">
                           <span class="pcoded-micon"><i class="ti-view-list-alt"></i></span>
                           <span class="pcoded-mtext">Home</span>
                           <span class="pcoded-mcaret"></span>
                           </a>
                        </li>
                        <li class="pcoded-hasmenu">
                           <a href="booking_list.html">
                           <span class="pcoded-micon"><i class="ti-view-list-alt"></i></span>
                           <span class="pcoded-mtext">Booking List</span>
                           <span class="pcoded-mcaret"></span>
                           </a>
                        </li>
                     </ul>
                  </div>
               </nav>
               <!-- Sidebar inner chat end-->
               <div class="pcoded-wrapper">
                  <div class="pcoded-content">
                     <div class="pcoded-inner-content">
                        <!-- Main-body start -->
                        <div class="main-body">
                           <div class="page-wrapper">
                              <!-- Page-header start -->
                              <div class="page-header card m-t-40">
                                 <div class="row align-items-end">
                                    <div class="col-lg-8">
                                       <div class="page-header-title" id="trainbookcontent">
                                          <i class="icofont icofont-restaurant-menu bg-c-pink "></i>
                                          <div class="d-inline">
                                             <h4>Train Booking System</h4>
                                             <span>Manage train tickets</span>
                                          </div>
                                       </div>

                                       <div id="sucessMessage" class="page-header-title" style="display: none; background:yellowgreen">
                                          <div class="d-inline">
                                             <h4 id="confirmStatus"></h4>
                                          </div>
                                       </div>

                                    </div>
                                    <div class="col-lg-4">
                                       <div class="page-header-breadcrumb">
                                          <ul class="breadcrumb-title">
                                             <li class="breadcrumb-item">
                                                <a href="index.html">
                                                <i class="icofont icofont-home"></i>
                                                </a>
                                             </li>
                                             <li class="breadcrumb-item"><a href="#!">Manage Ticket</a>
                                             </li>
                                          </ul>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                              <!-- Page-header end -->
                              <!-- Page body start -->
                              <div id="responseTicket" class="page-body" style="display: none">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="card">
                                                    <div class="card-header">
                                                        <h5>Train Booking</h5>
                                                    </div>
                                                    <div class="card-block table-border-style">
                                                        <div class="table-responsive col-lg-12">
                                                            <table class="table table-framed">
                                                                <thead>
                                                                    <tr>
                                                                        <th>#</th>
                                                                        <th>Name</th>
                                                                        <th>Age</th>
                                                                        <th>Gender</th>
                                                                        <th>Status</th>
                                                                        <th>Berth</th>
                                                                        <th>PNR</th>
                                                                        <th>Date</th>
                                                                        
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="passengerDetails">
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <center><a class="btn btn-success btn-square" href="index.html">Go Back</a></center>
                                    </div>


                              <div class="page-body" id="bookticketDivID">
                                 <div class="row">
                                    <div class="col-lg-12">
                                       <div class="card">
                                          <div class="card-header">
                                             <h5>Train Booking</h5>
                                          </div>
                                          <div class="card-block">
                                             <form id="add_people_form" method="post">
                                                <div id="czContainer">
                                                   <div id="first">
                                                      <div class="recordset">
                                                         <div class="fieldRow clearfix form-group row">
                                                            <div class="col-sm-4">
                                                               <div id="div_id_passenger_1_name" class="form-group">
                                                                  <div class="controls ">
                                                                     <input type="text" name="name" id="id_passenger_1_name" class="pass_name textinput form-control" placeholder="Passenger Name"/>         
                                                                  </div>
                                                               </div>
                                                            </div>
                                                            <div class="col-sm-2">
                                                               <div id="div_id_passenger_1_age" class="form-group">
                                                                  <div class="controls ">
                                                                     <input type="text" name="age" id="id_passenger_1_age" class="pass_age textinput form-control" placeholder="Passenger Age" />         
                                                                  </div>
                                                               </div>
                                                            </div>
                                                            <div class="col-sm-3">
                                                               <div id="div_id_gender_1_data" class="form-group">
                                                                  <div class="controls ">
                                                                     <select class="form-control pass_gender" id="id_gender_1_data" name="gender">
                                                                        <option value="">---Select Gender---</option>
                                                                        <option value="male">Male</option>
                                                                        <option value="female">Female</option>
                                                                     </select>
                                                                  </div>
                                                               </div>
                                                            </div>
                                                            <div class="col-sm-3">
                                                               <div id="div_id_berth_1_data" class="form-group">
                                                                  <div class="controls ">
                                                                     <select class="form-control" id="id_berth_1_data" name="berth_preference">
                                                                        <option value="NB">---Select Berth---</option>
                                                                        <option value="UB">Upper Berth</option>
                                                                        <option value="MB">Middle Berth</option>
                                                                        <option value="LB">Lower Berth</option>
                                                                        <option value="SUB">Side Upper Berth</option>
                                                                        <!-- <option value="SLB">Side Lower Berth</option> -->
                                                                     </select>
                                                                  </div>
                                                               </div>
                                                            </div>
                                                         </div>
                                                      </div>
                                                   </div>
                                                </div>
                                                <div class="clearfix"></div>
                                                <div class="col-sm-12" style="text-align: center;">
                                                   <button id="click" type="button" class="btn btn-success btn-square">Confirm</button>
                                                </div>
                                             </form>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                              <!-- Page body end -->
                           </div>
                        </div>
                        <!-- Main-body end -->
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      </div>
      <!-- Warning Section Ends -->
      <!-- Required Jquery -->
      <script type="text/javascript" src="assets/bower_components/jquery/js/jquery_new.min.js"></script>
      <script src="assets/js/jquery.czMore-1.5.3.2.js"></script>
      <script type="text/javascript" src="assets/bower_components/jquery-ui/js/jquery-ui.min.js"></script>
      <script type="text/javascript" src="assets/bower_components/popper.js/js/popper.min.js"></script>
      <script type="text/javascript" src="assets/bower_components/bootstrap/js/bootstrap.min.js"></script>
      <!-- jquery slimscroll js -->
      <script type="text/javascript" src="assets/bower_components/jquery-slimscroll/js/jquery.slimscroll.js"></script>
      <!-- modernizr js -->
      <script type="text/javascript" src="assets/bower_components/modernizr/js/modernizr.js"></script>
      <script type="text/javascript" src="assets/bower_components/modernizr/js/css-scrollbars.js"></script>
      <!-- i18next.min.js -->
      <script type="text/javascript" src="assets/bower_components/i18next/js/i18next.min.js"></script>
      <script type="text/javascript" src="assets/bower_components/i18next-xhr-backend/js/i18nextXHRBackend.min.js"></script>
      <script type="text/javascript" src="assets/bower_components/i18next-browser-languagedetector/js/i18nextBrowserLanguageDetector.min.js"></script>
      <script type="text/javascript" src="assets/bower_components/jquery-i18next/js/jquery-i18next.min.js"></script>
      <!-- Custom js -->
      <script src="assets/js/pcoded.min.js"></script>
      <script src="assets/js/menu/menu-hori-fixed.js"></script>
      <script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
      <script type="text/javascript" src="assets/js/script.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.min.js"></script>
      <script type="text/javascript">
         //One-to-many relationship plugin by Yasir O. Atabani. Copyrights Reserved.
         $("#czContainer").czMore();

            setTimeout(function() {
             $('#btnPlus').click();
         }, 200);


$(function() {
    $("#click").click(function(e) {
        e.stopPropagation();
        errorStatus = false
        $("#add_people_form input.pass_name").each(function() {
            if(this.value == "") {
               if ($('.'+this.id).length > 0) { 
                  $('.'+this.id).remove();
               }
               $('#'+this.id).after("<label class='"+this.id+"'></label>");
               $('.'+this.id).text(this.placeholder +' is required').css('color', 'red');
               errorStatus = true;
            }
            else {
               if ($('.'+this.id).length > 0) { 
                  $('.'+this.id).remove();
               }
            }
        });
        $("#add_people_form input.pass_age").each(function() {
            if(this.value == "" || !$.isNumeric(this.value)) {
               if ($('.'+this.id).length > 0) { 
                  $('.'+this.id).remove();
               }
               $('#'+this.id).after("<label class='"+this.id+"'></label>");
               $('.'+this.id).text(this.placeholder +' is required and it should be integer').css('color', 'red');
               errorStatus = true;
            } else {
               if ($('.'+this.id).length > 0) { 
                  $('.'+this.id).remove();
               }
            }
        });
        $("#add_people_form select.pass_gender").each(function() {
            if(this.value == "") {
               if ($('.'+this.id).length > 0) { 
                  $('.'+this.id).remove();
               }
               $('#'+this.id).after("<label class='"+this.id+"'></label>");
               $('.'+this.id).text('Gender is required').css('color', 'red');
               errorStatus = true;
            } else {
               if ($('.'+this.id).length > 0) { 
                  $('.'+this.id).remove();
               }
            }
        });
        if(errorStatus){
            return false;
        } else{
            keys = [];
            vals = [];
            datas = [];
            var i = 1;
            $('#add_people_form input, select').each(function(){
               if(this.name != "czContainer_czMore_txtCount"){
                  keys.push(this.name); //keys
                  vals.push(this.value); //values
               }
               if(i == 5){
                  datas.push(vals.associate(keys));
                  i = 1;
               }
               i++;
            });

            $.ajax({
              url: "http://127.0.0.1:8000/train/book/",
              method: "POST", 
              dataType: 'json',
              contentType: "application/json",
              processData: false,
              data: JSON.stringify(datas)
            }).success(function(response) { 
               $('#bookticketDivID').hide();
               $('#passengerDetails').html(printBookedTickets(response));
               $('#responseTicket').css('display', 'block');
               $('#trainbookcontent').hide();
               $('#confirmStatus').text("Successfully Booked Your Ticket. Please Keep Follow your Booking Status");
               $('#sucessMessage').css('display', 'block');
               console.log(response);
            }).error(function(XHR, textStatus, errorThrown) { 
                  alert(XHR.responseJSON[0].error[0]);
                  console.log('error' + XHR, textStatus, errorThrown);
            });
            }
    });
});

Array.prototype.associate = function (keys) {
  var result = {};

  this.forEach(function (el, i) {
    result[keys[i]] = el;
  });

  return result;
};


printBookedTickets = function(response){
   var html = "";
   var i = 1;
   $(response).each(function(){
      html +='<tr><th scope="row">'+i+'</th><td>'+this.name+'</td><td>'+this.age+'</td><td>'+this.gender+'</td><td>'+this.status+'</td><td>'+this.berth_preference+'</td><td>'+this.pnr+'</td><td>'+this.created_date+'</td></tr>'
   });
   return html;
}
      </script>
   </body>
</html>